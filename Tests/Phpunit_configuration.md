# PhpUnit configuration
Default required PhpUnit configuration and explanations

## Configuration reference
```xml
<phpunit xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="http://schema.phpunit.de/4.8/phpunit.xsd"
  stopOnError="true"
  stopOnFailure="true"

  convertErrorsToExceptions="true"
  convertNoticesToExceptions="true"
  convertWarningsToExceptions="true"
  beStrictAboutOutputDuringTests="true"
  beStrictAboutChangesToGlobalState="true"
  beStrictAboutTestsThatDoNotTestAnything="true"

  forceCoversAnnotation="true"

  backupGlobals="true"
  backupStaticAttributes="false"
  processIsolation="false"

  checkForUnintentionallyCoveredCode="true"

  bootstrap="vendor/autoload.php"

  colors="true"
>
  <testsuites>
    <testsuite name="technical">
      <directory>tests/Technical/Unit/*</directory> <!-- launch unit before => faster than integration -->
      <directory>tests/Technical/Integration/*</directory>
    </testsuite>
    <testsuite name="functional"> <!-- defined functional after technical => longer than technical -->
      <directory>tests/Functional/*</directory>
    </testsuite>
  </testsuites>

  <filter>
    <whitelist>
      <directory>src</directory>
    </whitelist>
  </filter>
</phpunit>
```

## Explanations
### Early stop
 * `stopOnError="true"` : Will stop execution at first test error
 * `stopOnFailure="true"` : Will stop execution at first test failure
 
   *Require* **StrictModeListener** *to convert risky test to failed test*

Stopping execution of phpunit is useful for CI, as it will produce builds with a smaller execution time

*It's not really useful for the developer, 
but it's better to keep it there in order to let him having the same behavior than CI (to be able to fix an issue)*

### Strict mode
 * Turn php notices/warnings/errors on **test or tested code** into failed test
   * `convertErrorsToExceptions="true"`
   * `convertNoticesToExceptions="true"`
   * `convertWarningsToExceptions="true"`

<a name="converToRiskyTest"></a>
 * Converts a test into **Risky test** if :
   * `beStrictAboutOutputDuringTests="true"` : **test or tested code** displays something
     
     *Require* **StrictModeListener** *to remove the generated coverage* => No coverage for risky tests
     
     *Require* **StrictModeListener** *to convert test into failed test* => No risky tests
     
     => STRANGE BEHAVIOR - Do not allow tests with strange behavior (usually it's the result of forgotten debug statements)

   * `beStrictAboutChangesToGlobalState="true"` : **test or tested code** manipulates global variables.
   
     *Require* **`backupGlobals="true"`**
     
     *This option will remove the coverage generated by the test.* => No coverage for risky tests

     *Require* **StrictModeListener** *to convert test into failed test* => No risky tests
     
     => OLD SCHOOL CODE - except for 0.01% of tests

   * `beStrictAboutTestsThatDoNotTestAnything="true"` : test does no assertion
     
     *Require* **StrictModeListener** *to convert test into failed test*

     *This option will remove the coverage generated by the test.*
     
     => MAINTENANCE - Do not allow useless tests
   
     => STRANGE BEHAVIOR - Test should probably be completed

### Tests isolation
A test must not impact another (and so a test must not expect that another test has been executed)
* `backupGlobals="true"` : Also required by `beStrictAboutChangesToGlobalState="true"`
* `backupStaticAttributes="false"`
* `processIsolation="false"`

  Should be enabled to reinforce isolation, but could create some edge cases
  
  Current configuration sufficiently reinforce strict tests

### Coverage
 * `forceCoversAnnotation="true"`
 
   Force the use of `@covers` annotation 
   
   => reinforce "real" coverage. An intregration test could use many dependencies without interfering in dependencies class code coverage (and so in related class C.R.A.P. score)
   
   => Qickly spot which class is tested

   If no annotation, no coverage.
   
   Symply add the following as test class or test method comment
```
/**
 * @covers FULLY\QUALIFIED\NAMESPACE\TO\MyClass
 */
```

 * `checkForUnintentionallyCoveredCode="true"`

   *This option will remove the coverage generated by the test.* => No coverage for risky tests

   Force the use of `@uses` to show tested class dependencies. 
   
   => Quickly spot tested class dependencies
   
   Simply add the following as class comment : 
```
/**
 * @uses FULLY\QUALIFIED\NAMESPACE\TO\TestedClassDpenencyClassA
 * @uses FULLY\QUALIFIED\NAMESPACE\TO\TestedClassDpenencyClassB
 */
class TestedClassTest extends \PHPUnit_Framework_TestCase
```

### Autoload
 * `bootstrap="vendor/autoload.php"` : Compose autoload file. *Not required*

### Output
 * `colors="true"` : Pretty output. *Not required*

## Listener
Listener will
 * convert any risky test to failed test, so phpunit command will return a failed status 
 
   => Strict mode

 * remove coverage for test with output. Require **beStrictAboutOutputDuringTests="true"**
